import{OrbitControls as e}from"three/examples/jsm/controls/OrbitControls.js";import{BufferGeometryUtils as t}from"three/examples/jsm/utils/BufferGeometryUtils.js";import{BufferGeometry as n,BufferAttribute as r,Scene as o,WebGLRenderer as a,OrthographicCamera as i,PerspectiveCamera as s,MOUSE as l,Vector2 as c,PointsMaterial as p,VertexColors as u,Points as h,Vector3 as f,Color as d,Texture as y}from"three";import{scalePow as m,scaleOrdinal as g,scaleThreshold as v}from"d3-scale";import b from"underscore";import{extent as A,schemeCategory10 as S,symbols as w,symbol as C,select as O,format as E}from"d3";import x from"d3-svg-legend";import I from"react-select";import P from"react";var D={circle:",iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACtElEQVRYR+2Wz2sTQRTH5+2mNu2QbJY1Ymuym9nkInjwR/HgQRQVEf8Db9KDB0+K+CfovT0IIuKf4EVBUfSioGD1KJjdndmEEJrY1mQDadjdkZFWSkmT3aQShO5133vfz7z9znsLaMIPTFgfHQD8nx2wLOs6ABQ45/qWhxhCiBWLxRdxPRW5A/V6HXe73UdhGN7AGNclSTqWSCT+6Pm+j8IwrHqedxQAnhFCbgNALwpMJADbts8DwHNVVdV0Oo0A+qdxzlGr1ULr6+utIAiulUqlj8MghgLUarUF3/ff5vP59LBiO99Xq9W2LMsX5ufnVwblDQQol8snpqamPui6Hkt8W5Ax1uacnyWEfN8LYiAApbSZy+U0WZbjHP5vbBAEyHXdhmmaR2IDUErvzs7OPshms9MjqW8lNRqNzU6nc58QstSvzp4dYIx91TTtJMZ4HH3U6XTQ2traF13XF2IBWJYVEkJgL8dHpRI3g1IamqbZ9zv27YBt21eSyeTrubm5qDoD42q1Gur1ehcJIe93B/YFoJQ+yWQyi4qi7AvAxsaGmA+PDcO4FRlAUZTFTCYzGQDLsi7NzMy8mdgnEMfeLxOGYYgYY/FMKAAYYyuapp2a2DV0HOcOxvjhuINodXW11+127xmGsRxrDohgx3Ga+Xx+5FEs1nSlUmmappmNPYpFAqX0OELok2EYqVGug+u6nu/7p4vF4o+RALa8cAYh9E7X9VgQruv+Eus4l8t9G3kdbyeWy+Vzsiy/VFVVSaVSSJKkvjWF49vttpj9bYTQZdM0Pw/r3NAfku0CnPNDtm0vAcBNjHETAIQ3psWu8H1/k3P+0/O8w5IkPS0UCuKXLBwmLt5HBthZzHGcq0EQFADA4JwLIVeWZUYIeRVFdGfMSABxRcb2wH4KRlpG/1LwAGB3B34DBWQWMG24djEAAAAASUVORK5CYII=",cross:",iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAA50lEQVRYR+2XPQ6DMAyF8QZbfIYchN4spRer6D1yBcyWbKmylZI4WB0oklmdn8cnvfcAupMfOPn+7noCvPeOo2atnSRURQTy5cMwuL7vi/tijCmE8LDW3o+KEAtARIeIxX1ElIhIBSiBixNo+HxExBvngmVZXgDwrNnwOyc2dmr5PB+KiKzFiag6L+XETgDn86PhUltXygkVoAT+jwBXt7/aMITQxRinz7re1ar3vtrlADAaY3IYVet4Xdc5pTQzQbQ5X78HlIASEBPgcqLk81aDigTkw7icyHPJP0FeLxbQeiPpXAW8AUg5MTAvQNb8AAAAAElFTkSuQmCC",diamond:",iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACaElEQVRYR9WXy4vTUBTG05DW2E7sI6XPlOTeUkTcqeB2QHApIrgTXIr+AbrVlW5cKbidlStFXKsrl+IsB4T23tiGtolp2pLbTh9JkQwpjNppmkyHYFaB3POdX777OidCBXwQQhdpmv5GUdRisVhchxD+CCIVCRLkxGCMv+fz+SvOu6qq+wCAq0G0AgHU6/Xb8Xh8r1gsJp2knU5nOJ1O7wMAPvqFCASAMTYEQUgzDHOUz7IsqtVq9SGEmTMHwBg/5TjuCc/z7PFkvV5vYprmCwDAMz8QvhzQNG2HEKIDAM6tSoIxnrEsmy6VSuNNIXwBYIzf8zx/h+O4lfqmaVKGYbyTJOnu1gEajca1aDT6pVKpXFgnriiKadv2riRJ+5tAbOwAxvigUChcYtk/pv6fHJPJhOp2uwcAgMtbA0AI3UskEm9yudzOJqKqqpLRaPSgWq2+9Rq/kQMIoUNRFFmapr30jr7btk01m80xhDDhFeAJgBB6mUqlHqbT6fNeYse/9/v9w8Fg8BpC+Hhd3FoAjHEhEok0RFGM+0m+HCvL8tiyLKlWq/06KX4tgCzLn7PZ7I1EwtPJlfqEEErX9U8AgJu+ATDGuwzDfBAEIRXk75cxiqIM5vP5LQjh11U6JzqAEGqWy+VKLBY7TX5qNptR7Xb7JwBA+r8AQp8Cx65QF6EDEPo2dCCcgyiZTD7KZDLrL4G/VphhGJPhcPjqVAfRUjPUo9h1wddlpGkaIYRs7zJy10N417EDEHpB4roQXknmAIRelLourCzLdV2fEkKen2lZvtyWoTYmDkTorZk7FeE1p+7htJX2/DfV7WYwLPkGlAAAAABJRU5ErkJggg==",square:",iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAp0lEQVRYR+2WMQ4CIRBFWQoyFQ03YG7naqPHsNEY9XLADSjooFrD1mJixmRj8qlh/ssbij+pjc+0cb4CAAx8NBBCOGitjfCjVu/9fTRjCNDDiehKRKI1tdaWWuuemR/vIIbDU0ona+3ZOScCyDkvpZQjM18AAAMwAAMwAAMw8HcGZmPM7UeFZGbm51cG+uUY404pJa1kbRTeM0RtR9gV1+cAgIHNDbwAdNviIRMkcw0AAAAASUVORK5CYII=","triangle-down":",iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAC2klEQVRYR+2WPWzTQBiGnR/iFrs4pFadpolyn09VJZAYOjDQCYmFiYVKIDHQgRWxMCAhIaSuHWCEAXWknZAQG1IHJAbEAggGcpc4bVK3Sdu0SUwSXBu5clHTpk7sJC0D3uLcfe9z730/9jGn/PhOWZ/5dwAURblgGEbiJBzx+XxZhNAPS+uvA5RSJRQK8f0GME3Tp+v6NgBAEwAh5DbHcS8lSeL6CbG2tlbVNG1GluXFJgDrRyaT+SZJ0sWBgYG+MNRqNUZV1a8AcGlfoCkJM5nMZCAQWIrH40P9IFheXq7ouj4ly/KXlgC2C4uRSOTm0FBvGXZ2dpjNzc3XAHDr4OGOlGE+nz9bq9W2ACDUSxcopbphGPz4+HjdEcD6M51OP+F5/pEoimwvIIrFYr1cLs/Ksjx7ON6xjSidTm/E4/FIMBjsikHXdWZlZWUDAMRWgZwAbrAsOz86Oip0Q6Cq6ramaXcwxm9dAdhX8VmSpMnBwUFPDJqmMcVi8VMymbx8XADHWUApnfD7/VYATyWRzWatspvEGP/0BGBtUhRlXhCEaUEQXNlQKpV+lUqlBQC462RfR9OQEGLKsuzqGiilDMa4bfy2C+zm9JDjuMeiKJ7rhKJQKJQ1TXuKEJprt74jADshV2OxWDQUcu5PjUaDyefzqwAQayd+ZBg5bSCEXGNZdmFsbOy807pcLrdVr9enMcbvewpgJ+SH4eHhKY5rPbGr1SpTKBSWAOBqJ+KuHLAWp1KpRDAY/J5MJlt+uCiKUg0EAhOJRCLXFwA7F56Fw+F74XC4qSztsnsBAA86FXftwH5gQkgDIXTG7/fvvTIMw/qY+Y0xdj1BO66Cg6cihMzwPP98ZGRk7yrW19crlUrlPsb4lZvTe3bA7g0kGo3udSdVVSlCCLsV7woglUpdYVn2nRVkd3f3OkLo44kC2GX5xjRNKx+mvYh35YBXwcP7PCVhr8T/O2A58AfGZw8wtSahoQAAAABJRU5ErkJggg==","triangle-up":",iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAC3UlEQVRYR+2VP2gTURzHLyG5tOnFXD0uJsTj3u9dB4s4iIIOIk5uDnUQQdChuApOBScFh4KDg4uDOgkKKoKO4iAI4lIciiD03rtoSnOJTbzcJTmS651EraTm312a2qVvvd/v+/2873vvdyFml1dol/2ZPYBtJUApfdk+QgCYG/UoRwZQVfVULBZ77Xke02w2zymK8n4UiJEBKKU0k8mgtmmhUKAIIfzfAAgh8xzH3RVFMdE2LRaLZq1Wu44xfhgUYqQEVFVtAUAkFPrd7rouo2maoyhKdMcBCCH3eJ6fn56enuw0q1QqjWq1+gAhdC0IRKAECCFyOBxelmWZ62WSy+WsjY2Nw4qifPULEQhA07QPoiiejMfjPfVrtRpTKpXeAcCZsQMQQs6yLPskm83uHyS+urpabjabFzHGb/xA+E6AUlrIZrMHotHB96zVajH5fF7HGKfHBkApXZiamrohiuI+P6KlUqlar9dvI4TuDKsfmoDneWFCSAtjHB4m1vmdEOIpijK0ZyiApmmPeZ6fSyaTvW9eHyrDMOqGYTyXZfnKIPCBAJqmzTIM81GW5V8TL+jK5XKG67onMMZf+vUOA1hKpVJHJye3zBzfHI1Gg9F1fQkAjgUGWFlZmYvH448ymQzv27FH4drammHb9mWM8ateOn0TIIRUJEniI5HIdvwZx3Haz7IMAIJvAErpzUQisSAIwsS23P80r6+v26ZpLgLArX/1uhIoFoucZVnfASA2DvNNjfZTZlk2KUlSo1O3C4BS+kIQhPOJxEgXvy+zaZpMuVx+hhC60BdAVdXj0Wj0rSRJviZe0ITy+bzpOM5pAPi02bslAUrp53Q6PTsxMZaj7+Kzbbv9LJcRQke6AFRVvcRx3P1UKtXzXx90t/3qdV23LMu6OjMz87Rd8zcBQojGsuyORN8J43leyHGcHwAAWwAopYdc1z04rp0OnP+h0LfN8Tz0Z7TTQHsAPwHv3BIw9zTkUQAAAABJRU5ErkJggg=="},K=function(e){this.symbolType=e};K.prototype.load=function(){var e=new Image;e.src="data:image/png;base64"+D[this.symbolType];var t=new y(e);return t.needsUpdate=!0,t};var M=Object.keys(D),R="other";function T(e){var t=typeof e;return"number"===t&&(t="int",Number.isInteger(e)||(t="float")),t}function j(e,t){for(var n=new Array(e.length),r=0;r<e.length;r++)n[r]=e[t[r]];return n}function k(e,t){var n=b.countBy(e);n=b.sortBy(b.pairs(n),function(e){return-e[1]});for(var r=b.map(n.slice(0,t),function(e){return e[0]}),o=0;o<e.length;o++)-1===r.indexOf(e[o])&&(e[o]=R);return e}function U(e,t){for(var n=A(e),r=parseFloat(n[0]),o=parseFloat(n[1]),a=(o-r)/t,i=b.range(1,t).map(function(e){return e*a+r}),s=[r.toFixed(2)+" to "+i[0].toFixed(2)],l=0;l<t-1;l++){if(l===t-2)var c=i[l].toFixed(2)+" to "+o.toFixed(2);else c=i[l].toFixed(2)+" to "+i[l+1].toFixed(2);s.push(c)}return{labels:s,domain:i,min:r,max:o,interval:a}}function B(e,t){for(var n=A(e),r=parseFloat(n[0]),o=parseFloat(n[1]),a=["0 to "+t[0]],i=t.length,s=0;s<i-1;s++)a.push(t[s]+" to "+t[s+1]);return{labels:a,domain:t.slice(0,-1),min:r,max:o}}var V=function(e){this.data=e,this.n=e.length;var t=this.getIndicesAndPositions(e),n=t.positions;this.indices=t.indices,this.positions=n};V.prototype.getIndicesAndPositions=function(e){for(var t=this.n,n=new Uint32Array(t),r=new Float32Array(3*t),o=0;o<t;o++)n[o]=o,r[3*o]=e[o].x,r[3*o+1]=e[o].y,r[3*o+2]=e[o].z||0;return{indices:n,positions:r}},V.prototype.getAttr=function(e){return this.data.map(function(t){return t[e]})};var z=function(e){this.data=e,this.n=e.length,this.metas=[],this.parse();var t=this.getIndicesAndPositions(),n=t.positions;this.indices=t.indices,this.positions=n};function F(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function L(e,t){return e(t={exports:{}},t.exports),t.exports}z.prototype.parse=function(){for(var e=this,t=this.data,n=["x","y","z"],r=function(){var r=a[o];if(-1===n.indexOf(r)){var i=t.map(function(e){return e[r]}),s=[].concat(new Set(i)).length,l=T(t[0][r]);e.metas.push({name:r,nUnique:s,type:l})}},o=0,a=Object.keys(t[0]);o<a.length;o+=1)r()},z.prototype.getIndicesAndPositions=function(){for(var e=this.n,t=new Uint32Array(e),n=new Float32Array(3*e),r=0;r<e;r++)t[r]=r,n[3*r]=this.data[r].x,n[3*r+1]=this.data[r].y,n[3*r+2]=this.data[r].z||0,this.data[r].index=r;return{indices:t,positions:n}},z.prototype.getLabels=function(e){for(var t=new Array(this.n),n=0,r=0,o=this.data;r<o.length;r+=1){for(var a=o[r],i="",s=0,l=e;s<l.length;s+=1){var c=l[s];i+=c+": "+a[c]+" \n"}t[n]=i,n++}return t},z.prototype.groupBy=function(e){var t=b.groupBy(this.data,e);return b.mapObject(t,function(e,t){return new V(e)})},z.prototype.binBy=function(e,t){var n=function(e,t,n){var r=U(b.pluck(e,t),n),o=r.labels,a=r.min,i=r.interval;return b.groupBy(e,function(e){var r=Math.floor((e[t]-a)/i);return r===n&&(r=n-1),o[r]})}(this.data,e,t);return b.mapObject(n,function(e,t){return new V(e)})},z.prototype.binBy2=function(e,t){var n=function(e,t,n){var r=B(b.pluck(e,t),n).labels;return b.groupBy(e,function(e){var o=b.filter(n,function(n){return n<e[t]}).length;return r[o]})}(this.data,e,t);return b.mapObject(n,function(e,t){return new V(e)})},z.prototype.getAttr=function(e){return this.data.map(function(t){return t[e]})},z.prototype.setAttr=function(e,t){for(var n=0;n<this.n;n++){var r=this.data[n];r[e]=t[n],this.data[n]=r}this.metas.push({name:e,nUnique:[].concat(new Set(t)).length,type:T(t[0])})},z.prototype.getColorOptions=function(){var e=this;return this.metas.filter(function(t){return t.nUnique<e.n&&t.nUnique>1}).map(function(e){return{value:e.name,label:e.name}})},z.prototype.getShapeOptions=function(){return this.metas.filter(function(e){return"float"!==e.type&&e.nUnique<7&&e.nUnique>1}).map(function(e){return{value:e.name,label:e.name}})},z.prototype.getSearchOptions=function(e){for(var t=this,n=[],r=function(){var e=a[o],r=t.getAttr(e);r=(r=[].concat(new Set(r))).map(function(t){return{value:t,label:t,key:e}}),n.push(r={label:e,options:r})},o=0,a=e;o<a.length;o+=1)r();return n},z.prototype.calculateColorScale=function(e){var t=this.getAttr(e),n=b.findWhere(this.metas,{name:e}),r=n.type;"float"!==r&&"int"!==r&&n.nUnique>20&&(t=k(t,19));var o=new Set(t),a=o.size;if(-1!==(o=Array.from(o)).indexOf("unknown")&&o.length>7){var i=o.indexOf("unknown"),s=7;20===o.length&&(s=15);var l=o[s];o[s]="unknown",o[i]=l}if(-1!==o.indexOf(R)&&20===o.length){var c=o.indexOf(R),p=15;-1!==o.indexOf("unknown")&&(p=14);var u=o[p];o[p]=R,o[c]=u}var h=A(t),f=h[0],d=h[1],y=m().domain([f,(f+d)/2,d]).range(["#1f77b4","#ddd","#d62728"]);return"boolean"===r?y=g().domain([!0,!1]).range(["#cc0000","#cccccc"]):a<11?y=g(S).domain(o):a>10&&a<=20?y=g(S).domain(o):a<=40&&(y=g().range(["#1b70fc","#faff16","#d50527","#158940","#f898fd","#24c9d7","#cb9b64","#866888","#22e67a","#e509ae","#9dabfa","#437e8a","#b21bff","#ff7b91","#94aa05","#ac5906","#82a68d","#fe6616","#7a7352","#f9bc0f","#b65d66","#07a2e6","#c091ae","#8a91a7","#88fc07","#ea42fe","#9e8010","#10b437","#c281fe","#f92b75","#07c99d","#a946aa","#bfd544","#16977e","#ff6ac8","#a88178","#5776a9","#678007","#fa9316","#85c070","#6aa2a9","#989e5d","#fe9169","#cd714a","#6ed014","#c5639c","#c23271","#698ffc","#678275","#c5a121","#a978ba","#ee534e","#d24506","#59c3fa","#ca7b0a","#6f7385","#9a634a","#48aa6f","#ad9ad0","#d7908c","#6a8a53","#8c46fc","#8f5ab8","#fd1105","#7ea7cf","#d77cd1","#a9804b","#0688b4","#6a9f3e","#ee8fba","#a67389","#9e8cfe","#bd443c","#6d63ff","#d110d5","#798cc3","#df5f83","#b1b853","#bb59d8","#1d960c","#867ba8","#18acc9","#25b3a7","#f3db1d","#938c6d","#936a24","#a964fb","#92e460","#a05787","#9c87a0","#20c773","#8b696d","#78762d","#e154c6","#40835f","#d73656","#1afd5c","#c4f546","#3d88d8","#bd3896","#1397a3","#f940a5","#66aeff","#d097e7","#fe6ef9","#d86507","#8b900a","#d47270","#e8ac48","#cf7c97","#cebb11","#718a90","#e78139","#ff7463","#bea1fd"]).domain(o)),y},z.prototype.calculateShapeScale=function(e){var t,n=w.map(function(e){return C().type(e)()}),r=b.findWhere(this.metas,{name:e}),o=this.groupBy(e),a=g().domain(Object.keys(o)).range(n);if(-1!==["int","float"].indexOf(r.type)&&r.nUnique>6){o=this.binBy(e,6);var i=U(b.pluck(this.data,e),6);if("p-value"===r.name){var s=[.001,.01,.05,.1,1];o=this.binBy2(e,s),i=B(b.pluck(this.data,e),s),n=b.map(w.slice(0,s.length),function(e){return C().type(e)()})}a=v().domain(i.domain).range(n),t=i.labels}return{shapeScale:a,shapeLabels:t,scatterDataSubsets:o}};var H=L(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&Symbol.for,r=n?Symbol.for("react.element"):60103,o=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,i=n?Symbol.for("react.strict_mode"):60108,s=n?Symbol.for("react.profiler"):60114,l=n?Symbol.for("react.provider"):60109,c=n?Symbol.for("react.context"):60110,p=n?Symbol.for("react.async_mode"):60111,u=n?Symbol.for("react.concurrent_mode"):60111,h=n?Symbol.for("react.forward_ref"):60112,f=n?Symbol.for("react.suspense"):60113,d=n?Symbol.for("react.suspense_list"):60120,y=n?Symbol.for("react.memo"):60115,m=n?Symbol.for("react.lazy"):60116,g=n?Symbol.for("react.fundamental"):60117,v=n?Symbol.for("react.responder"):60118,b=n?Symbol.for("react.scope"):60119;function A(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case p:case u:case a:case s:case i:case f:return e;default:switch(e=e&&e.$$typeof){case c:case h:case l:return e;default:return t}}case m:case y:case o:return t}}}function S(e){return A(e)===u}t.typeOf=A,t.AsyncMode=p,t.ConcurrentMode=u,t.ContextConsumer=c,t.ContextProvider=l,t.Element=r,t.ForwardRef=h,t.Fragment=a,t.Lazy=m,t.Memo=y,t.Portal=o,t.Profiler=s,t.StrictMode=i,t.Suspense=f,t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===a||e===u||e===s||e===i||e===f||e===d||"object"==typeof e&&null!==e&&(e.$$typeof===m||e.$$typeof===y||e.$$typeof===l||e.$$typeof===c||e.$$typeof===h||e.$$typeof===g||e.$$typeof===v||e.$$typeof===b)},t.isAsyncMode=function(e){return S(e)||A(e)===p},t.isConcurrentMode=S,t.isContextConsumer=function(e){return A(e)===c},t.isContextProvider=function(e){return A(e)===l},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===r},t.isForwardRef=function(e){return A(e)===h},t.isFragment=function(e){return A(e)===a},t.isLazy=function(e){return A(e)===m},t.isMemo=function(e){return A(e)===y},t.isPortal=function(e){return A(e)===o},t.isProfiler=function(e){return A(e)===s},t.isStrictMode=function(e){return A(e)===i},t.isSuspense=function(e){return A(e)===f}});F(H);var Q=L(function(e,t){"production"!==process.env.NODE_ENV&&function(){Object.defineProperty(t,"__esModule",{value:!0});var e="function"==typeof Symbol&&Symbol.for,n=e?Symbol.for("react.element"):60103,r=e?Symbol.for("react.portal"):60106,o=e?Symbol.for("react.fragment"):60107,a=e?Symbol.for("react.strict_mode"):60108,i=e?Symbol.for("react.profiler"):60114,s=e?Symbol.for("react.provider"):60109,l=e?Symbol.for("react.context"):60110,c=e?Symbol.for("react.async_mode"):60111,p=e?Symbol.for("react.concurrent_mode"):60111,u=e?Symbol.for("react.forward_ref"):60112,h=e?Symbol.for("react.suspense"):60113,f=e?Symbol.for("react.suspense_list"):60120,d=e?Symbol.for("react.memo"):60115,y=e?Symbol.for("react.lazy"):60116,m=e?Symbol.for("react.fundamental"):60117,g=e?Symbol.for("react.responder"):60118,v=e?Symbol.for("react.scope"):60119;function b(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:var f=e.type;switch(f){case c:case p:case o:case i:case a:case h:return f;default:var m=f&&f.$$typeof;switch(m){case l:case u:case s:return m;default:return t}}case y:case d:case r:return t}}}var A=c,S=p,w=l,C=s,O=n,E=u,x=o,I=y,P=d,D=r,K=i,M=a,R=h,T=!1;function j(e){return b(e)===p}t.typeOf=b,t.AsyncMode=A,t.ConcurrentMode=S,t.ContextConsumer=w,t.ContextProvider=C,t.Element=O,t.ForwardRef=E,t.Fragment=x,t.Lazy=I,t.Memo=P,t.Portal=D,t.Profiler=K,t.StrictMode=M,t.Suspense=R,t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===o||e===p||e===i||e===a||e===h||e===f||"object"==typeof e&&null!==e&&(e.$$typeof===y||e.$$typeof===d||e.$$typeof===s||e.$$typeof===l||e.$$typeof===u||e.$$typeof===m||e.$$typeof===g||e.$$typeof===v)},t.isAsyncMode=function(e){return T||(T=!0,function(e,t){if(void 0===t)throw new Error("`lowPriorityWarningWithoutStack(condition, format, ...args)` requires a warning message argument");if(!e){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=0,a="Warning: "+e.replace(/%s/g,function(){return n[o++]});"undefined"!=typeof console&&console.warn(a);try{throw new Error(a)}catch(e){}}).apply(void 0,[t].concat(r))}}(!1,"The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),j(e)||b(e)===c},t.isConcurrentMode=j,t.isContextConsumer=function(e){return b(e)===l},t.isContextProvider=function(e){return b(e)===s},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===n},t.isForwardRef=function(e){return b(e)===u},t.isFragment=function(e){return b(e)===o},t.isLazy=function(e){return b(e)===y},t.isMemo=function(e){return b(e)===d},t.isPortal=function(e){return b(e)===r},t.isProfiler=function(e){return b(e)===i},t.isStrictMode=function(e){return b(e)===a},t.isSuspense=function(e){return b(e)===h}}()});F(Q);var G=L(function(e){e.exports="production"===process.env.NODE_ENV?H:Q}),q=Object.getOwnPropertySymbols,W=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable,Y=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(e){r[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,r,o=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),a=1;a<arguments.length;a++){for(var i in n=Object(arguments[a]))W.call(n,i)&&(o[i]=n[i]);if(q){r=q(n);for(var s=0;s<r.length;s++)N.call(n,r[s])&&(o[r[s]]=n[r[s]])}}return o},J="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",X=function(){};if("production"!==process.env.NODE_ENV){var _=J,Z={},$=Function.call.bind(Object.prototype.hasOwnProperty);X=function(e){var t="Warning: "+e;"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(e){}}}function ee(e,t,n,r,o){if("production"!==process.env.NODE_ENV)for(var a in e)if($(e,a)){var i;try{if("function"!=typeof e[a]){var s=Error((r||"React class")+": "+n+" type `"+a+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[a]+"`.");throw s.name="Invariant Violation",s}i=e[a](t,a,r,n,null,_)}catch(e){i=e}if(!i||i instanceof Error||X((r||"React class")+": type specification of "+n+" `"+a+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof i+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument)."),i instanceof Error&&!(i.message in Z)){Z[i.message]=!0;var l=o?o():"";X("Failed "+n+" type: "+i.message+(null!=l?l:""))}}}ee.resetWarningCache=function(){"production"!==process.env.NODE_ENV&&(Z={})};var te=ee,ne=Function.call.bind(Object.prototype.hasOwnProperty),re=function(){};function oe(){return null}function ae(){}function ie(){}"production"!==process.env.NODE_ENV&&(re=function(e){var t="Warning: "+e;"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(e){}}),ie.resetWarningCache=ae;var se=L(function(e){e.exports="production"!==process.env.NODE_ENV?function(e,t){var n="function"==typeof Symbol&&Symbol.iterator,r="@@iterator",o="<<anonymous>>",a={array:l("array"),bool:l("boolean"),func:l("function"),number:l("number"),object:l("object"),string:l("string"),symbol:l("symbol"),any:s(oe),arrayOf:function(e){return s(function(t,n,r,o,a){if("function"!=typeof e)return new i("Property `"+a+"` of component `"+r+"` has invalid PropType notation inside arrayOf.");var s=t[n];if(!Array.isArray(s))return new i("Invalid "+o+" `"+a+"` of type `"+p(s)+"` supplied to `"+r+"`, expected an array.");for(var l=0;l<s.length;l++){var c=e(s,l,r,o,a+"["+l+"]",J);if(c instanceof Error)return c}return null})},element:s(function(t,n,r,o,a){var s=t[n];return e(s)?null:new i("Invalid "+o+" `"+a+"` of type `"+p(s)+"` supplied to `"+r+"`, expected a single ReactElement.")}),elementType:s(function(e,t,n,r,o){var a=e[t];return G.isValidElementType(a)?null:new i("Invalid "+r+" `"+o+"` of type `"+p(a)+"` supplied to `"+n+"`, expected a single ReactElement type.")}),instanceOf:function(e){return s(function(t,n,r,a,s){var l;return t[n]instanceof e?null:new i("Invalid "+a+" `"+s+"` of type `"+((l=t[n]).constructor&&l.constructor.name?l.constructor.name:o)+"` supplied to `"+r+"`, expected instance of `"+(e.name||o)+"`.")})},node:s(function(e,t,n,r,o){return c(e[t])?null:new i("Invalid "+r+" `"+o+"` supplied to `"+n+"`, expected a ReactNode.")}),objectOf:function(e){return s(function(t,n,r,o,a){if("function"!=typeof e)return new i("Property `"+a+"` of component `"+r+"` has invalid PropType notation inside objectOf.");var s=t[n],l=p(s);if("object"!==l)return new i("Invalid "+o+" `"+a+"` of type `"+l+"` supplied to `"+r+"`, expected an object.");for(var c in s)if(ne(s,c)){var u=e(s,c,r,o,a+"."+c,J);if(u instanceof Error)return u}return null})},oneOf:function(e){return Array.isArray(e)?s(function(t,n,r,o,a){for(var s=t[n],l=0;l<e.length;l++)if((c=s)===(p=e[l])?0!==c||1/c==1/p:c!=c&&p!=p)return null;var c,p,h=JSON.stringify(e,function(e,t){return"symbol"===u(t)?String(t):t});return new i("Invalid "+o+" `"+a+"` of value `"+String(s)+"` supplied to `"+r+"`, expected one of "+h+".")}):("production"!==process.env.NODE_ENV&&re(arguments.length>1?"Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z]).":"Invalid argument supplied to oneOf, expected an array."),oe)},oneOfType:function(e){if(!Array.isArray(e))return"production"!==process.env.NODE_ENV&&re("Invalid argument supplied to oneOfType, expected an instance of array."),oe;for(var t=0;t<e.length;t++){var n=e[t];if("function"!=typeof n)return re("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+h(n)+" at index "+t+"."),oe}return s(function(t,n,r,o,a){for(var s=0;s<e.length;s++)if(null==(0,e[s])(t,n,r,o,a,J))return null;return new i("Invalid "+o+" `"+a+"` supplied to `"+r+"`.")})},shape:function(e){return s(function(t,n,r,o,a){var s=t[n],l=p(s);if("object"!==l)return new i("Invalid "+o+" `"+a+"` of type `"+l+"` supplied to `"+r+"`, expected `object`.");for(var c in e){var u=e[c];if(u){var h=u(s,c,r,o,a+"."+c,J);if(h)return h}}return null})},exact:function(e){return s(function(t,n,r,o,a){var s=t[n],l=p(s);if("object"!==l)return new i("Invalid "+o+" `"+a+"` of type `"+l+"` supplied to `"+r+"`, expected `object`.");var c=Y({},t[n],e);for(var u in c){var h=e[u];if(!h)return new i("Invalid "+o+" `"+a+"` key `"+u+"` supplied to `"+r+"`.\nBad object: "+JSON.stringify(t[n],null,"  ")+"\nValid keys: "+JSON.stringify(Object.keys(e),null,"  "));var f=h(s,u,r,o,a+"."+u,J);if(f)return f}return null})}};function i(e){this.message=e,this.stack=""}function s(e){if("production"!==process.env.NODE_ENV)var n={},r=0;function a(a,s,l,c,p,u,h){if(c=c||o,u=u||l,h!==J){if(t){var f=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw f.name="Invariant Violation",f}if("production"!==process.env.NODE_ENV&&"undefined"!=typeof console){var d=c+":"+l;!n[d]&&r<3&&(re("You are manually calling a React.PropTypes validation function for the `"+u+"` prop on `"+c+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),n[d]=!0,r++)}}return null==s[l]?a?new i(null===s[l]?"The "+p+" `"+u+"` is marked as required in `"+c+"`, but its value is `null`.":"The "+p+" `"+u+"` is marked as required in `"+c+"`, but its value is `undefined`."):null:e(s,l,c,p,u)}var s=a.bind(null,!1);return s.isRequired=a.bind(null,!0),s}function l(e){return s(function(t,n,r,o,a,s){var l=t[n];return p(l)!==e?new i("Invalid "+o+" `"+a+"` of type `"+u(l)+"` supplied to `"+r+"`, expected `"+e+"`."):null})}function c(t){switch(typeof t){case"number":case"string":case"undefined":return!0;case"boolean":return!t;case"object":if(Array.isArray(t))return t.every(c);if(null===t||e(t))return!0;var o=function(e){var o=t&&(n&&t[n]||t[r]);if("function"==typeof o)return o}();if(!o)return!1;var a,i=o.call(t);if(o!==t.entries){for(;!(a=i.next()).done;)if(!c(a.value))return!1}else for(;!(a=i.next()).done;){var s=a.value;if(s&&!c(s[1]))return!1}return!0;default:return!1}}function p(e){var t=typeof e;return Array.isArray(e)?"array":e instanceof RegExp?"object":function(e,t){return"symbol"===e||!!t&&("Symbol"===t["@@toStringTag"]||"function"==typeof Symbol&&t instanceof Symbol)}(t,e)?"symbol":t}function u(e){if(null==e)return""+e;var t=p(e);if("object"===t){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return t}function h(e){var t=u(e);switch(t){case"array":case"object":return"an "+t;case"boolean":case"date":case"regexp":return"a "+t;default:return t}}return i.prototype=Error.prototype,a.checkPropTypes=te,a.resetWarningCache=te.resetWarningCache,a.PropTypes=a,a}(G.isElement,!0):function(){function e(e,t,n,r,o,a){if(a!==J){var i=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw i.name="Invariant Violation",i}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:ie,resetWarningCache:ae};return n.PropTypes=n,n}()}),le=function(e){this.model=e.model,this.geometry=null,this.createGeometry()};le.prototype.createGeometry=function(){var e=new n,t=this.model;e.setIndex(new r(t.indices,1)),e.addAttribute("position",new r(t.positions,3)),e.userData={index:t.getAttr("index")},e.computeBoundingSphere(),this.geometry=e};var ce=function(n){function y(e){n.call(this,e);var t=this.props.is3d;this.state={isLoading:!1,isLoaded:!1,url:this.props.url,data:this.props.data,model:null,WIDTH:this.props.width||1400,HEIGHT:this.props.height||800,DPR:this.props.DPR||2,labelKeys:this.props.labelKeys,colorKey:this.props.colorKey,shapeKey:this.props.shapeKey,pointSize:t?.5:12,is3d:t,colorScale:this.props.colorScale,shapeScale:this.props.shapeScale,shapeLabels:this.props.shapeLabels},this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this)}return n&&(y.__proto__=n),(y.prototype=Object.create(n&&n.prototype)).constructor=y,y.prototype.componentDidMount=function(){var e=this;this.props.url&&(this.setState({isLoading:!0}),fetch(this.props.url).then(function(e){if(e.ok)return e.json();throw new Error("Something went wrong when fetching data ...")}).then(function(t){e.setState({data:t,model:new z(t),isLoading:!1,isLoaded:!0}),e.makeMaterial(),e.setUpStage(),e.shapeBy(e.state.shapeKey)}))},y.prototype.componentDidUpdate=function(e,t,n){this.props.url||(null===t.data&&null===e.data&&null!==this.props.data&&null===this.state.data?(this.makeMaterial(),this.setUpStage()):null!==this.props.data&&null!==this.props.shapeScale&&(this.shapeBy(this.props.shapeKey),this.startAnimate()))},y.prototype.componentWillUnmount=function(){this.animateId&&this.stopAnimate()},y.prototype.render=function(){var e=this;return P.createElement("div",{ref:function(t){return e.mount=t},onMouseDown:function(t){return e.onMouseDown(t)},onMouseMove:function(t){return e.onMouseMove(t)},onMouseUp:function(t){return e.onMouseUp(t)}})},y.prototype.setUpStage=function(){var t=this.state,n=t.WIDTH,r=t.HEIGHT,p=t.DPR,u=n/r,h=new o;this.id=h.uuid;var f=new a;f.setClearColor(16777215),f.setPixelRatio(p),f.setSize(n,r);var d=-10.5,y=10.5,m=-10.5,g=10.5;u>1?(d*=u,y*=u):(g/=u,m/=u);var v=new i(d,y,g,m,-1e3,1e3);this.state.is3d&&((v=new s(70,u,.01,1e6)).position.z=30),f.domElement.id="renderer-"+this.id,this.mount.appendChild(f.domElement);var b=new e(v,f.domElement);b.enableZoom=!0,b.enableDamping=!0,b.dampingFactor=.25,b.screenSpacePanning=!0,this.state.is3d?(b.autoRotate=!0,b.autoRotateSpeed=2):(b.enableRotate=!1,b.mouseButtons={LEFT:l.RIGHT,MIDDLE:l.DOLLY,RIGHT:l.LEFT}),b.addEventListener("start",function(){b.autoRotate=!1});var A=new c;this.scene=h,this.renderer=f,this.camera=v,this.controls=b,this.mouse=A,this.updated=!0},y.prototype.onMouseDown=function(e){this.mouseMoved=!1},y.prototype.onMouseMove=function(e){var t=this.mouse,n=this.state,r=n.HEIGHT;t.x=e.nativeEvent.offsetX/n.WIDTH*2-1,t.y=-e.nativeEvent.offsetY/r*2+1,this.mouse=t,this.updated=!0,this.mouseMoved=!0},y.prototype.onMouseUp=function(e){if(!this.mouseMoved&&"function"==typeof this.props.onClick){var t=this.points.geometry.userData.index[this.getPoint()];this.props.onClick(e,this.props.model.data[t])}},y.prototype.makeMaterial=function(){for(var e=[],t=0,n=M;t<n.length;t+=1){var r=new K(n[t]).load(),o=new p({vertexColors:u,size:this.state.pointSize,sizeAttenuation:this.state.is3d,map:r,alphaTest:.2,transparent:!0,opacity:.6});e.push(o)}this.materials=e},y.prototype.clearScene=function(){for(var e=this.scene,t=0,n=e.children;t<n.length;t+=1)e.remove(n[t])},y.prototype.shapeBy=function(e){for(var n=this.props.model,r=this.scene,o=n.calculateShapeScale(e).scatterDataSubsets,a=[],i=0,s=Object.keys(o);i<s.length;i+=1){var l=new le({model:o[s[i]]});a.push(l.geometry)}var c=t.mergeBufferGeometries(a),p=a.map(function(e){return e.userData.index}).reduce(function(e,t){return e.concat(t)}),u=n.getLabels(this.state.labelKeys);u=j(u,p),c.userData={index:p,labels:u};var f=a.map(function(e){return e.index.count}),d=f.reduce(function(e,t,n){return e.concat([t+(e[n-1]||0)])},[]);d.unshift(-1);for(var y=0;y<a.length;y++)c.addGroup(d[y]+1,f[y],y);var m=new h(c,this.materials);this.clearScene(),r.add(m),this.points=m,this.setColors(this.props.colorScale,this.props.colorKey)},y.prototype.renderScatter=function(){var e=this.getPoint();this.resetColors();var t=document.getElementById("text-label-"+this.id);if(t&&t.remove(),void 0!==e){this.points.geometry.attributes.color.needsUpdate=!0,this.points.geometry.attributes.color.array[3*e]=.1,this.points.geometry.attributes.color.array[3*e+1]=.8,this.points.geometry.attributes.color.array[3*e+2]=.1;var n={x:this.points.geometry.attributes.position.array[3*e],y:this.points.geometry.attributes.position.array[3*e+1],z:this.points.geometry.attributes.position.array[3*e+2]},r=this.makeTextCanvas(this.points.geometry.userData.labels[e],n.x,n.y,n.z,this.points.rotation,{fontsize:24,fontface:"arial, sans-serif",textColor:{r:0,g:0,b:0,a:.8}});r.id="text-label-"+this.id,this.mount.appendChild(r),"function"==typeof this.props.onMouseOver&&this.props.onMouseOver(this.props.model.data[this.points.geometry.userData.index[e]])}},y.prototype.makeTextCanvas=function(e,t,n,r,o,a){void 0===a&&(a={});var i,s=a.hasOwnProperty("fontface")?a.fontface:"arial, sans-serif",l=a.hasOwnProperty("fontsize")?a.fontsize:18,c=a.hasOwnProperty("textColor")?a.textColor:{r:0,g:0,b:255,a:.8},p=a.hasOwnProperty("lineHeight")?a.lineHeight:20,u=document.createElement("canvas"),h=u.getContext("2d"),d=this.state,y=d.WIDTH,m=d.HEIGHT;u.width=y,u.height=m,h.font=l+"px "+s,h.textBaseline="alphabetic",h.textAlign="left",h.fillStyle="rgba("+(i=c).r+","+i.g+","+i.b+","+i.a+")";for(var g=new f(t,n,r).applyEuler(o),v=(new f).copy(g).project(this.camera),b={x:(v.x+1)/2*y,y:-(v.y-1)/2*m},A=e.split("\n"),S=0;S<A.length;S++)h.fillText(A[S],b.x,b.y+S*p);return u.style.left=0,u.style.top=0,u.style.position="absolute",u.style.pointerEvents="none",u},y.prototype.resetColors=function(){this.setColors(this.props.colorScale,this.props.colorKey)},y.prototype.setColors=function(e,t){var n=this.props.model,o=n.getAttr(t),a=this.points.geometry;o=j(o,a.userData.index);var i=b.findWhere(n.metas,{name:t}),s=i.type;"float"!==s&&"int"!==s&&i.nUnique>20&&(o=k(o,19));var l=new Float32Array(3*n.n),c={length:2};e.hasOwnProperty("domain")&&(c=e.domain().slice());for(var p=o.length-1;p>=0;p--){var u=e(o[p]);(u=new d(u)).toArray(l,3*p)}if(c.length>3)for(var h=o.length-1;h>=0;h--){var f=e(o[h]);-1===c.indexOf(o[h])&&(f=e(R)),(f=new d(f)).toArray(l,3*h)}a.addAttribute("color",new r(l.slice(),3))},y.prototype.startAnimate=function(){this.animateId||this.animate()},y.prototype.animate=function(){var e=this,t=this.renderer,n=this.scene,r=this.camera;this.controls.update(),this.updated&&(this.renderScatter(),this.updated=!1),t.render(n,r),this.animateId=window.requestAnimationFrame(function(){return e.animate()})},y.prototype.stopAnimate=function(){window.cancelAnimationFrame(this.animateId)},y.prototype.highlightQuery=function(e,t){this.removeHighlightedPoints();var n=j(this.props.model.data,this.points.geometry.userData.index).filter(function(n){return n[e]===t}),r=new V(n),o=this.createHighlightCloud(r);o.name="highlight-"+this.id,this.scene.add(o)},y.prototype.createHighlightCloud=function(e){var t=new le({model:e}),n=new p({size:5*this.state.pointSize,sizeAttenuation:this.state.is3d,map:this.materials[0].map,transparent:!0,opacity:.4,color:16776960}),r=new h(t.geometry,n);return r.rotation.x=this.points.rotation.x,r.rotation.y=this.points.rotation.y,r},y.prototype.removeHighlightedPoints=function(){var e=this.scene;e.remove(e.getObjectByName("highlight-"+this.id))},y.prototype.getPoint=function(){for(var e=this.mouse,t=this.camera,n=void 0,r=void 0,o=new f,a=new c,i=0,s=this.points.geometry.index.array;i<s.length;i+=1){var l=s[i];o.set(this.points.geometry.attributes.position.array[3*l],this.points.geometry.attributes.position.array[3*l+1],this.points.geometry.attributes.position.array[3*l+2]),o.project(t),a.set(o.x,o.y);var p=a.distanceToSquared(e);p<Math.min(1,1/(t.zoom*t.zoom))&&(void 0===r||p<r)&&(n=l,r=p)}return n},y}(P.Component);ce.propTypes={data:se.arrayOf(se.shape({x:se.number.isRequired,y:se.number.isRequired,z:se.number})),model:se.any,width:se.number,height:se.number,DPR:se.number,colorKey:se.string,shapeKey:se.string,labelKeys:se.arrayOf(se.string),colorScale:se.any,shapeScale:se.any,shapeLabels:se.any,is3d:se.bool,onClick:se.func,onMouseOver:se.func,id:se.string,setProps:se.func};var pe=function(e){function t(t){e.call(this,t),this.state={width:this.props.width||300,height:this.props.height||800}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.componentDidMount=function(){this.setUpDOMs()},t.prototype.componentDidUpdate=function(e,t,n){e.colorScale!==this.props.colorScale&&this.displayColorLegend(this.props.colorScale,this.props.colorKey),e.shapeScale!==this.props.shapeScale&&this.displayShapeLegend(this.props.shapeScale,this.props.shapeKey,this.props.shapeLabels)},t.prototype.render=function(){var e=this;return P.createElement("div",{ref:function(t){return e.mount=t}})},t.prototype.setUpDOMs=function(){var e=this.state,t=e.width,n=e.height;this.el=O(this.mount).append("svg").attr("id","legend").attr("width",t).attr("height",n),this.g=this.el.append("g").attr("class","legend").attr("transform","translate(10, 20)"),this.g.append("g").attr("id","legendShape").attr("class","legendPanel").attr("transform","translate(0, 0)"),this.g.append("g").attr("id","legendColor").attr("class","legendPanel").attr("transform","translate(110, 0)"),this.mount.style.position="absolute",this.mount.style.zIndex=10,this.mount.style.overflow="visible",this.mount.style.left=0,this.mount.style.top=0,this.mount.style.pointerEvents="none"},t.prototype.displayShapeLegend=function(e,t,n){var r=x.legendSymbol().scale(e).orient("vertical").title(t);n&&r.labels(n),this.g.select("#legendShape").call(r)},t.prototype.displayColorLegend=function(e,t){var n=x.legendColor().title(t).shapeWidth(20).cells(5).labelFormat(E(".2f")).scale(e);this.g.select("#legendColor").call(n)},t}(P.Component),ue=function(e){function t(t){e.call(this,t),this.state={label:this.props.label,options:null,defaultValue:this.props.defaultValue},this.handleChange=this.handleChange.bind(this)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.render=function(){var e=this;return P.createElement("div",{ref:function(t){return e.mount=t}},P.createElement("label",null,this.props.label),P.createElement(I,{defaultValue:this.state.defaultValue,options:this.props.options,onChange:this.handleChange,styles:{container:function(){return{width:e.props.width}}}}))},t.prototype.handleChange=function(e){this.props.onSelectChange(e)},t}(P.Component),he=function(e){function t(t){e.call(this,t),this.state={searchStr:"",searched:!1},this.handleChange=this.handleChange.bind(this),this.handleClear=this.handleClear.bind(this)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.render=function(){var e=this,t=this.state.searched;return P.createElement("div",{ref:function(t){return e.mount=t}},P.createElement("label",null,this.props.label),P.createElement(I,{defaultValue:"",defaultInputValue:"",placeholder:"Type to search...",options:this.props.options,onChange:this.handleChange,styles:{container:function(){return{width:e.props.width}}}}),t&&P.createElement("button",{onClick:this.handleClear,className:"btn btn-sm btn-outline-secondary",style:{marginTop:5}},"Clear highlighted points"))},t.prototype.handleChange=function(e){this.setState({searched:!0}),this.props.onInputChange(e)},t.prototype.handleClear=function(){this.setState({searched:!1}),this.props.onClearBtnClicked()},t}(P.Component),fe={Legend:pe,SelectDropdown:ue,SearchSelectize:he},de=function(e){function t(t){e.call(this,t),this.state={data:null,model:null,colorScale:null,shapeScale:null,shapeLabels:null,colorKey:this.props.colorKey,shapeKey:this.props.shapeKey,labelKeys:this.props.labelKeys,searchKeys:this.props.searchKeys,is3d:this.props.is3d},this.handleColorKeyChange=this.handleColorKeyChange.bind(this),this.handleShapeKeyChange=this.handleShapeKeyChange.bind(this),this.handleSearchInputChange=this.handleSearchInputChange.bind(this),this.handleClearBtnClick=this.handleClearBtnClick.bind(this)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.componentDidMount=function(){void 0!==this.props.data&&this.setState({data:this.props.data,model:new z(this.props.data)})},t.prototype.componentDidUpdate=function(e,t){e.data!==this.props.data&&this.setState(void 0===this.props.data?{data:null,model:null}:{data:this.props.data,model:new z(this.props.data)})},t.prototype.render=function(){var e=this,t=this.state,n=t.colorKey,r=t.shapeKey,o=t.labelKeys,a=t.searchKeys,i=t.is3d,s=this.state,l=s.colorScale,c=s.shapeScale,p=s.shapeLabels,u=this.props,h=u.width,f=u.height,d=null,y=null,m=null;return this.state.model&&(d=this.state.model.getColorOptions(),y=this.state.model.getShapeOptions(),a&&(m=this.state.model.getSearchOptions(a))),P.createElement("div",{style:{position:"relative",padding:0,width:h,height:f}},P.createElement(ce,{data:this.state.data,model:this.state.model,width:h,height:f,DPR:window.devicePixelRatio,colorKey:n,shapeKey:r,labelKeys:o,colorScale:l,shapeScale:c,shapeLabels:c,is3d:i,onClick:this.props.onClick,onMouseOver:this.props.onMouseOver,ref:function(t){e.scatter3dView=t}}),P.createElement(pe,{colorScale:l,colorKey:n,shapeScale:c,shapeKey:r,shapeLabels:p}),P.createElement("div",{style:{zIndex:10,top:0,right:0,width:200,position:"absolute"}},d&&d.length>1&&P.createElement(ue,{label:"Color by:",defaultValue:{value:n,label:n},options:d,onSelectChange:this.handleColorKeyChange,width:180}),y&&y.length>1&&P.createElement(ue,{label:"Shape by:",defaultValue:{value:r,label:r},options:y,onSelectChange:this.handleShapeKeyChange,width:180}),a&&a.length>1&&P.createElement(he,{label:"Search:",options:m,onInputChange:this.handleSearchInputChange,onClearBtnClicked:this.handleClearBtnClick,width:180})))},t.prototype.handleColorKeyChange=function(e){var t=e.value;if(t!==this.state.colorKey){var n=this.state.model.calculateColorScale(t);this.setState({colorKey:t,colorScale:n})}},t.prototype.handleShapeKeyChange=function(e){var t=e.value;if(t!==this.state.shapeKey){var n=this.state.model.calculateShapeScale(t);this.setState({shapeKey:t,shapeScale:n.shapeScale,shapeLabels:n.shapeLabels})}},t.prototype.handleSearchInputChange=function(e){this.scatter3dView.highlightQuery(e.key,e.value)},t.prototype.handleClearBtnClick=function(){this.scatter3dView.removeHighlightedPoints()},t.prototype.componentDidUpdate=function(e,t){if(null===t.data&&t.data!==this.state.data){var n=this.state,r=n.shapeKey,o=this.state.model,a=o.calculateColorScale(n.colorKey),i=o.calculateShapeScale(r);this.setState({colorScale:a,shapeScale:i.shapeScale,shapeLabels:i.shapeLabels})}},t}(P.Component);de.propTypes={data:se.arrayOf(se.shape({x:se.number.isRequired,y:se.number.isRequired,z:se.number})),shapeKey:se.string,colorKey:se.string,labelKeys:se.arrayOf(se.string),searchKeys:se.arrayOf(se.string),width:se.number,height:se.number,is3d:se.bool,onClick:se.func,onMouseOver:se.func,id:se.string,setProps:se.func};var ye=function(e){function t(t){e.call(this,t),this.state={},this.onClick=this.onClick.bind(this),this.onMouseOver=this.onMouseOver.bind(this)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.onClick=function(e,t){var n=this.props.setProps;void 0!==t&&(console.log("click"),console.log(t),n({clickData:t}))},t.prototype.onMouseOver=function(e){var t=this.props,n=t.setProps;e!==t.hoverData&&(console.log("hover"),console.log(e),n({hoverData:e}))},t.prototype.render=function(){var e=this.props;return P.createElement(de,{id:e.id,data:e.data,setProps:e.setProps,shapeKey:e.shapeKey,colorKey:e.colorKey,labelKeys:e.labelKeys,searchKeys:e.searchKeys,width:e.width,height:e.height,is3d:e.is3d,onClick:this.onClick,onMouseOver:this.onMouseOver})},t}(P.Component);ye.defaultProps={clickData:null,hoverData:null},ye.propTypes={data:se.arrayOf(se.shape({x:se.number.isRequired,y:se.number.isRequired,z:se.number})),shapeKey:se.string,colorKey:se.string,labelKeys:se.arrayOf(se.string),searchKeys:se.arrayOf(se.string),width:se.number,height:se.number,is3d:se.bool,id:se.string,setProps:se.func,clickData:se.object,hoverData:se.object};var me=function(e){function t(t){e.call(this,t),this.state={children:null}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.componentDidMount=function(){var e=this;if("function"!=typeof this.props.children)throw new Error("Lazy component expects an asynchronous function body");this.props.children().then(function(t){return e.setState(function(){return{children:t}})})},t.prototype.render=function(){return null!==this.state.children?this.state.children:void 0===this.props.loading?null:"function"==typeof this.props.loading?this.props.loading():this.props.loading},t}(P.Component);me.propTypes={children:se.func,loading:se.oneOfType([se.element,se.elementType])};export{ye as DashScatterBoard,me as Lazy,ce as Scatter3dView,de as ScatterBoard,z as ScatterData,fe as ScatterWidgets};
//# sourceMappingURL=react-scatter-board.mjs.map
